## 什么是状态模式

状态模式是一种行为型设计模式，其主要目的是允许一个对象在内部状态改变时改变它的行为，对象看起来好像改变了它的类。

简单来说，想象一个电视机。当它处于“开机”状态时，你按遥控器“Power”按钮会关闭电视；当它处于“关机”状态时，按“Power”按钮会打开电视。

## 核心思想

状态模式将一个对象在不同状态下的行为封装到各自独立的状态类中。上下文对象（Context）不再直接处理所有状态的逻辑，而是将状态相关的行为委托给当前的状态对象。
当上下文的状态改变时，它就改变其持有的状态对象，从而改变其自身的行为。

## 状态模式的组成部分

状态模式通常包含以下三个核心角色：

环境 / 上下文 (Context)：

* 定义： 维护一个具体状态类的实例，这个实例代表了对象当前的内部状态。它将所有与状态相关的行为委托给当前的状态对象。
* 特点： 包含一个指向当前状态对象的引用。客户端通过上下文对象来操作，而无需直接与状态对象交互。上下文对象通常也提供方法来改变其当前的状态。
* 例子： TVContext。

抽象状态 (State Interface)：

* 定义： 声明一个抽象接口或抽象类，用于定义所有具体状态类都应该实现的、与上下文行为相关的方法。
* 特点： 所有具体状态都必须实现这个接口。
* 例子： TVState 接口，包含 pressPowerButton() 方法。

具体状态 (Concrete State)：

定义： 实现抽象状态接口。每个具体状态类都封装了在特定状态下上下文对象的行为。
特点： 每个具体状态类通常会持有上下文对象的引用，以便在执行操作后，可以改变上下文的状态（即切换到另一个具体状态）。
例子： TVOnState（开机状态）、TVOffState（关机状态）。

## 状态模式的优点

* 将状态相关的行为局部化： 将每个状态的行为封装到独立的类中，使得代码结构更清晰，易于理解和维护。
* 消除大量的条件语句： 避免了在上下文对象中出现大量的 if-else if 或 switch-case
  语句来判断当前状态并执行相应逻辑，使得上下文对象变得更加简洁。
* 提高可扩展性： 增加新的状态或改变现有状态的行为，只需增加新的具体状态类或修改现有状态类，而无需修改上下文对象（符合开闭原则）。
* 对象行为的动态改变： 对象的行为可以根据其内部状态在运行时动态改变。

## 状态模式的缺点

* 增加类的数量： 每个状态都需要一个独立的类，这可能导致类的数量膨胀，对于状态较少的简单场景可能显得过于复杂。
* 状态切换逻辑分散： 状态切换的逻辑分散在各个具体状态类中，如果状态切换非常复杂，可能会使整体流程难以一览无余。

## 状态模式的应用场景

* 当一个对象的行为取决于它的状态，并且它在运行时需要根据状态改变其行为时。
* 当一个操作中包含大量的条件语句，这些条件语句依赖于对象的状态时。
* 工作流引擎： 任务的不同阶段（待处理、进行中、已完成、已取消）。
* 游戏开发： 角色在不同状态下的行为（站立、行走、跳跃、攻击）。
* 网络协议： 连接的不同状态（已连接、断开、正在连接）。
* UI 组件： 按钮的不同状态（启用、禁用、按下）。